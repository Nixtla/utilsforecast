---
description: Utilities to validate input data
output-file: validation.html
title: Validation

---

```python
import datetime

from fastcore.test import test_eq, test_fail
```


```python
import polars.testing
```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/utilsforecast/blob/main/utilsforecast/validation.py#L37"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### ensure_shallow_copy

> ``` text
>  ensure_shallow_copy (df:pandas.core.frame.DataFrame)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/utilsforecast/blob/main/utilsforecast/validation.py#L46"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### ensure_time_dtype

> ``` text
>  ensure_time_dtype
>                     (df:Union[pandas.core.frame.DataFrame,polars.dataframe
>                     .frame.DataFrame], time_col:str='ds')
> ```

Make sure that `time_col` contains timestamps or integers. If it
contains strings, try to cast them as timestamps.

```python
pd.testing.assert_frame_equal(
    ensure_time_dtype(pd.DataFrame({'ds': ['2000-01-01']})),
    pd.DataFrame({'ds': pd.to_datetime(['2000-01-01'])})
)
df = pd.DataFrame({'ds': [1, 2]})
assert df is ensure_time_dtype(df)
test_fail(
    lambda: ensure_time_dtype(pd.DataFrame({'ds': ['2000-14-14']})),
    contains='Please make sure that it contains valid timestamps',
)
```


```python
pl.testing.assert_frame_equal(
    ensure_time_dtype(pl.DataFrame({'ds': ['2000-01-01']})),
    pl.DataFrame().with_columns(ds=pl.datetime(2000, 1, 1))
)
df = pl.DataFrame({'ds': [1, 2]})
assert df is ensure_time_dtype(df)
test_fail(
    lambda: ensure_time_dtype(pl.DataFrame({'ds': ['hello']})),
    contains='Please make sure that it contains valid timestamps',
)
```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/utilsforecast/blob/main/utilsforecast/validation.py#L74"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### validate_format

> ``` text
>  validate_format
>                   (df:Union[pandas.core.frame.DataFrame,polars.dataframe.f
>                   rame.DataFrame], id_col:str='unique_id',
>                   time_col:str='ds', target_col:Optional[str]='y')
> ```

Ensure DataFrame has expected format.

|             | **Type** | **Default** | **Details**                                |
|-------------|----------|-------------|--------------------------------------------|
| df          | Union    |             | DataFrame with time series in long format. |
| id_col      | str      | unique_id   | Column that identifies each serie.         |
| time_col    | str      | ds          | Column that identifies each timestamp.     |
| target_col  | Optional | y           | Column that contains the target.           |
| **Returns** | **None** |             |                                            |

```python
import datetime

from utilsforecast.compat import POLARS_INSTALLED, pl
from utilsforecast.data import generate_series
```


```python
test_fail(lambda: validate_format(1), contains="got <class 'int'>")
constructors = [pd.DataFrame]
if POLARS_INSTALLED:
    constructors.append(pl.DataFrame)
for constructor in constructors:
    df = constructor({'unique_id': [1]})
    test_fail(lambda: validate_format(df), contains="missing: ['ds', 'y']")
    df = constructor({'unique_id': [1], 'time': ['x'], 'y': [1]})
    test_fail(lambda: validate_format(df, time_col='time'), contains="('time') should have either timestamps or integers")
    for time in [1, datetime.datetime(2000, 1, 1)]:
        df = constructor({'unique_id': [1], 'ds': [time], 'sales': ['x']})
        test_fail(lambda: validate_format(df, target_col='sales'), contains="('sales') should have a numeric data type")
```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/utilsforecast/blob/main/utilsforecast/validation.py#L131"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### validate_freq

> ``` text
>  validate_freq
>                 (times:Union[pandas.core.series.Series,polars.series.serie
>                 s.Series], freq:Union[str,int])
> ```

```python
test_fail(lambda: validate_freq(pd.Series([1, 2]), 'D'), contains='provide a valid integer')
test_fail(lambda: validate_freq(pd.to_datetime(['2000-01-01']).to_series(), 1), contains='provide a valid pandas or polars offset')
```


```python
test_fail(lambda: validate_freq(pl.Series([1, 2]), '1d'), contains='provide a valid integer')
test_fail(lambda: validate_freq(pl.Series([datetime.datetime(2000, 1, 1)]), 1), contains='provide a valid pandas or polars offset')
test_fail(lambda: validate_freq(pl.Series([datetime.datetime(2000, 1, 1)]), 'D'), contains='valid polars offset')
```

